# Mock HTTP Output API with runtime chaos control.
# Usage:
#   docker compose up -d
#   Control panel: http://localhost:21203
#   Upload: POST http://localhost:21203/upload (responds based on current behavior)
#   Toggle chaos from the UI â€” no need to change URLs.
services:
  mock-http-output:
    build: .
    ports:
      - '21203:3000'
    environment:
      - PORT=3000
      # Optional: set MOCK_API_TOKEN to enforce Basic auth (username=token, password empty)
      # - MOCK_API_TOKEN=your-secret
    healthcheck:
      test:
        [
          'CMD',
          'node',
          '-e',
          "require('http').get('http://localhost:3000/health',r=>process.exit(r.statusCode===200?0:1))",
        ]
      interval: 5s
      timeout: 3s
      retries: 3
      start_period: 5s
